<%#
Copyright 2025 Matsumiko
Licensed under the Apache License, Version 2.0
-%>

<%+header%>

<style>
.autoedu-status {
	max-width: 1200px;
	margin: 16px auto 20px;
	padding: 0 4px 4px;
	box-sizing: border-box;
}

/* Title */
.autoedu-status h2 {
	margin: 0 0 10px;
	font-size: 1.7rem;
	font-weight: 800;
	letter-spacing: 0.03em;
	background: linear-gradient(90deg, #38bdf8, #6366f1);
	-webkit-background-clip: text;
	color: transparent;
	text-shadow: 0 0 10px rgba(15,23,42,0.9);
	display: flex;
	align-items: center;
	gap: 6px;
}

/* Grid */
.status-grid {
	display: grid;
	gap: 12px;
	margin-top: 8px;
}

/* Card: dark glass */
.test-card {
	background: rgba(15,23,42,0.92);
	backdrop-filter: blur(8px);
	-webkit-backdrop-filter: blur(8px);
	border: 1px solid rgba(75,85,99,0.9);
	border-radius: 16px;
	padding: 11px 12px 10px;
	box-shadow: 0 10px 26px rgba(15,23,42,0.95);
	color: #e5e7eb;
}

.test-card h3 {
	margin: 0 0 8px;
	font-size: 0.98rem;
	font-weight: 600;
	color: #f9fafb;
}

/* Test sections */
.test-card h4 {
	margin: 10px 0 4px;
	font-size: 0.82rem;
	color: #bfdbfe;
}

/* Buttons pakai gaya Argon dark */
.test-card .cbi-button {
	margin-top: 2px;
	padding: 5px 10px;
	border-radius: 8px;
	border: none;
	font-size: 0.74rem;
	cursor: pointer;
	display: inline-flex;
	align-items: center;
	gap: 5px;
	background: linear-gradient(90deg, #3b82f6, #6366f1);
	color: #e5e7eb;
	box-shadow: 0 4px 12px rgba(15,23,42,1);
	transition: all 0.16s ease;
}

.test-card .cbi-button:hover {
	transform: translateY(-1px);
	box-shadow: 0 7px 18px rgba(15,23,42,1);
	opacity: 0.98;
}

/* Result box */
.test-result {
	margin-top: 6px;
	padding: 7px 8px;
	border-radius: 8px;
	font-size: 0.78rem;
}

.test-success {
	background: rgba(22,163,74,0.16);
	color: #bbf7d0;
	border: 1px solid rgba(22,163,74,0.9);
}

.test-error {
	background: rgba(239,68,68,0.16);
	color: #fecaca;
	border: 1px solid rgba(248,113,113,0.9);
}

@media (max-width: 768px) {
	.autoedu-status {
		margin: 12px 4px 16px;
	}
}
</style>

<div class="autoedu-status">
	<h2>üîç System Status &amp; Diagnostics</h2>

	<div class="status-grid">
		<div class="test-card">
			<h3>Connection Tests</h3>

			<div>
				<h4>Telegram Bot</h4>
				<button class="cbi-button" onclick="testConnection('telegram')">üß™ Test Telegram</button>
				<div id="test-telegram-result"></div>
			</div>

			<div>
				<h4>ADB Device</h4>
				<button class="cbi-button" onclick="testConnection('adb')">üß™ Test ADB</button>
				<div id="test-adb-result"></div>
			</div>

			<div>
				<h4>SMS Access</h4>
				<button class="cbi-button" onclick="testConnection('sms')">üß™ Test SMS</button>
				<div id="test-sms-result"></div>
			</div>
		</div>
	</div>
</div>

<script>
const API_BASE = '<%=url("admin/services/autoedu/api")%>';

async function testConnection(type) {
	const resultDiv = document.getElementById(`test-${type}-result`);
	resultDiv.innerHTML = '<div class="test-result">Testing...</div>';

	try {
		const formData = new FormData();
		formData.append('type', type);

		const resp = await fetch(API_BASE + '/test', {
			method: 'POST',
			body: formData
		});

		const result = await resp.json();
		const ok = !!result.success;

		const className = ok ? 'test-success' : 'test-error';
		const icon = ok ? '‚úÖ' : '‚ùå';

		resultDiv.innerHTML = `
			<div class="test-result ${className}">
				${icon} ${result.message || (ok ? 'Success' : 'Failed')}
				${result.device ? '<br>Device: ' + result.device : ''}
				${result.error ? '<br>Error: ' + result.error : ''}
			</div>
		`;
	} catch (error) {
		resultDiv.innerHTML = `
			<div class="test-result test-error">
				‚ùå Error: ${error.message}
			</div>
		`;
	}
}
</script>

<%+footer%>
