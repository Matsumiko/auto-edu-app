<%#
Copyright 2025 Matsumiko
Licensed under the Apache License, Version 2.0
-%>

<%+header%>

<style>
.status-grid {
	display: grid;
	gap: 20px;
	margin-top: 20px;
}
.test-card {
	background: #fff;
	border: 1px solid #ddd;
	border-radius: 8px;
	padding: 20px;
}
.test-result {
	margin-top: 15px;
	padding: 10px;
	border-radius: 4px;
}
.test-success {
	background: #d4edda;
	color: #155724;
	border: 1px solid #c3e6cb;
}
.test-error {
	background: #f8d7da;
	color: #721c24;
	border: 1px solid #f5c6cb;
}
</style>

<h2>ğŸ” System Status & Diagnostics</h2>

<div class="status-grid">
	<!-- Connection Tests -->
	<div class="test-card">
		<h3>Connection Tests</h3>
		
		<div>
			<h4>Telegram Bot</h4>
			<button class="cbi-button" onclick="testConnection('telegram')">ğŸ§ª Test Telegram</button>
			<div id="test-telegram-result"></div>
		</div>
		
		<div style="margin-top: 20px;">
			<h4>ADB Device</h4>
			<button class="cbi-button" onclick="testConnection('adb')">ğŸ§ª Test ADB</button>
			<div id="test-adb-result"></div>
		</div>
		
		<div style="margin-top: 20px;">
			<h4>SMS Access</h4>
			<button class="cbi-button" onclick="testConnection('sms')">ğŸ§ª Test SMS</button>
			<div id="test-sms-result"></div>
		</div>
	</div>
</div>

<script>
const API_BASE = '<%=url("admin/services/autoedu/api")%>';

async function testConnection(type) {
	const resultDiv = document.getElementById(`test-${type}-result`);
	resultDiv.innerHTML = '<div class="test-result">Testing...</div>';
	
	try {
		const formData = new FormData();
		formData.append('type', type);
		
		const resp = await fetch(API_BASE + '/test', {
			method: 'POST',
			body: formData
		});
		
		const result = await resp.json();
		
		const className = result.success ? 'test-success' : 'test-error';
		const icon = result.success ? 'âœ…' : 'âŒ';
		
		resultDiv.innerHTML = `
			<div class="test-result ${className}">
				${icon} ${result.message}
				${result.device ? '<br>Device: ' + result.device : ''}
				${result.error ? '<br>Error: ' + result.error : ''}
			</div>
		`;
	} catch (error) {
		resultDiv.innerHTML = `
			<div class="test-result test-error">
				âŒ Error: ${error.message}
			</div>
		`;
	}
}
</script>

<%+footer%>
